<html>
  <head>
    <script src="three.js/three.js"></script>
    <script src="three.js/TrackballControls.js"></script>
    <script src="three.js/extras/helpers/ArrowHelper.js"></script>
    <script src="three.js/extras/helpers/AxisHelper.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="pnav.js"></script>

    <title>Potential field navigation</title>
  </head>
  <body>
    <script>
$(function() {
  var camera;
  var scene;
  var renderer;
  var geometry;
  var material;
  var mesh;

  var field = new pnav.fields.PotentialField();
  field.addBehavior(new pnav.behaviors.GoalSeeking(-500, -500, 0, 1000));
  field.addBehavior(new pnav.behaviors.CylinderObstacle(1500, -1000, 300, 1000));

  init();
  animate();

  function vectorArrow(x, y, z, v) {
    if (v.magnitude() < 0.0001) {
      return null;
    }
    var v = v.copy();
    var arrow = new THREE.ArrowHelper(
      new THREE.Vector3(v.x, v.y, v.z),
      new THREE.Vector3(x, y, z),
      v.magnitude() * 100,
      0x111111);
    return arrow;
  }

  function init() {

    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 10000);
    camera.position.x = 0
    camera.position.y = 0
    camera.position.z = 20000;
    camera.lookAt(new THREE.Vector3(2500, 0, 2500));

    scene = new THREE.Scene();
    scene.add(camera);
    scene.add(new THREE.AxisHelper(5000));

    var material = new THREE.MeshBasicMaterial({
      color: 0x0000ff,
      wireframe: true
    });
    var cylinder = new THREE.Mesh(new THREE.SphereGeometry(150, 10, 10), material);
    cylinder.position.x = 1500;
    cylinder.position.y = -1000;
    cylinder.overdraw = true;
    scene.add(cylinder);

    for (x = -3000; x < 3000; x += 250) {
      for (y = -3000; y < 3000; y += 250) {
        for (z = 0; z <= 0; z += 250) {
          var v = field.vectorAt(new pnav.math.Vector3(x + 1, y + 1, z + 1));
          var arrow = vectorArrow(x, y, z, v);
          if (arrow) {
            scene.add(arrow);
          }
        }
      }
    }
    material = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true } );

    renderer = new THREE.WebGLRenderer();
    renderer.setSize( window.innerWidth, window.innerHeight );

    // trackback _controls settings.
    var radius = 60;
    controls = new THREE.TrackballControls(camera, renderer.domElement);
    controls.rotateSpeed = 0.5;
    controls.zoomSpeed = 1.2;
    controls.panSpeed = 0.2;
    controls.noZoom = false;
    controls.noPan = false;
    controls.staticMoving = false;
    controls.dynamicDampingFactor = 0.3;
    controls.minDistance = radius * 1.1;
    controls.maxDistance = radius * 100;
    controls.keys = [65, 83, 68]; // [ rotateKey, zoomKey, panKey ]

    document.body.appendChild( renderer.domElement );

  }

  function animate() {

    // note: three.js includes requestAnimationFrame shim
    requestAnimationFrame( animate );

    controls.update();
    renderer.render( scene, camera );

  }
});
    </script>
  </body>
</html>
